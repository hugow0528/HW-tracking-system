
# 缺交功課管理平台

## 概要

本平台是一個基於 Google Apps Script 開發的網頁應用程式，旨在幫助老師輕鬆記錄、查看及管理學生缺交功課的情況。系統提供一個清晰的儀表板介面，並透過 Google Form 進行數據輸入，所有數據都安全地儲存在專案屬性中。

## 主要功能

*   **網頁儀表板**：提供一個現代化、易於使用的介面，按年級顯示所有缺交功課記錄。
*   **數據過濾**：可以按班別、學號及科目快速篩選記錄。
*   **Google Form 整合**：老師可以透過一個特製的 Google Form 快速提交缺交記錄，表單會自動顯示對應班別的學生名單。
*   **權限管理**：只有在白名單內的老師和管理員才能存取系統，確保數據安全。
*   **操作日誌**：管理員可以查看一個安全的事件日誌，記錄所有用戶的存取和操作（例如刪除記錄）。
*   **數據備份與還原**：管理員可以隨時將所有數據備份到一個新的 Google Sheet，並在需要時（例如更換部署帳戶後）將數據安全地還原到平台中，過程不會產生重複記錄。

## 首次安裝指南

如果你需要將此平台部署到一個全新的 Google 帳戶，請跟隨以下步驟：

#### **第 1 步：建立 Google Apps Script 專案**

1.  登入你的 Google 帳戶。
2.  前往 [Google Apps Script](https://script.google.com/)。
3.  點擊「新增專案」。

#### **第 2 步：複製程式碼**

專案內應該有 4 個檔案。請將我提供的完整程式碼複製並貼到對應的檔案中：
*   `Code.gs`
*   `index.html`
*   `log.html`
*   `denied.html`

#### **第 3 步：設定 `Code.gs` 檔案**

打開 `Code.gs` 檔案，修改頂部的「CONFIGURATION AREA」部分：

1.  `TEACHER_WHITELIST`: 加入所有授權使用此平台的老師電郵。
2.  `ADMIN_WHITELIST`: 加入管理員的電郵（他們可以查看日誌）。
3.  `SPREADSHEET_ID`: 填寫儲存學生名單的 Google Sheet ID。
4.  `SHEET_NAME`: 填寫學生名單在該 Sheet 中的分頁名稱。

#### **第 4 步：執行首次設定**

1.  在 Apps Script 編輯器頂部，從函數列表中選擇 `RUN_THIS_FIRST_TO_SETUP`。
2.  點擊「▶️ 執行」。
3.  系統會彈出授權請求，請點擊「審查權限」，選擇你的 Google 帳戶，然後在「不安全」頁面點擊「進階」，再選擇「前往 (專案名稱)」，最後允許所有權限。
4.  執行成功後，系統會自動建立一個 Google Form。

#### **第 5 步：取得 Google Form 連結**

1.  在函數列表中選擇 `RUN_THIS_TO_GET_FORM_URL`。
2.  點擊「▶️ 執行」。
3.  在下方的「執行記錄」中，你會看到老師用來提交記錄的 Google Form 連結。請將此連結分發給老師。

#### **第 6 步：部署為網絡應用程式**

1.  點擊右上角的藍色「部署」按鈕，選擇「新增部署」。
2.  在「選取類型」旁邊，點擊齒輪圖示並選擇「網路應用程式」。
3.  在「說明」中輸入「版本 1」。
4.  在「執行身分」欄位，選擇「我」。
5.  在「誰可以存取」欄位，選擇「任何擁有 Google 帳戶的使用者」。
6.  點擊「部署」。
7.  複製提供給你的「網址」，這就是平台的主頁連結。

## 日常操作指南

*   **老師**：
    1.  使用平台主頁連結進入儀表板。
    2.  點擊「開啟記錄表單」按鈕，打開 Google Form 提交缺交記錄。
    3.  在儀表板上選擇年級，使用篩選功能查看所需記錄。
    4.  如需刪除錯誤記錄，可點擊記錄旁邊的垃圾桶圖示。

*   **管理員**：
    1.  所有老師的功能都適用。
    2.  若要查看操作日誌，請在平台網址後面加上 `?page=log` 即可進入日誌頁面。

## 系統維護

#### **更新學生名單**

每當學年更新或學生資料有變動時：
1.  直接在你設定的學生名單 Google Sheet 中更新資料。
2.  更新完成後，回到 Apps Script 編輯器，執行 `RUN_THIS_TO_UPDATE_FORM` 函數。
3.  這會自動將最新的學生名單同步到 Google Form 的選項中。

#### **數據備份與還原 (重要)**

此功能用於在新帳戶上還原數據，或作定期備份。

**如何備份數據：**
1.  在 Apps Script 編輯器中，執行 `RUN_THIS_TO_BACKUP_DATA` 函數。
2.  執行成功後，查看「執行記錄」，你會找到一個新建立的 Google Sheet 連結，裡面包含了所有數據的完整備份。請妥善保管此連結。

**如何還原數據：**
1.  打開 `Code.gs` 檔案。
2.  找到 `RUN_THIS_TO_RESTORE_DATA` 函數。
3.  將你之前備份的 Google Sheet 連結貼到 `BACKUP_SHEET_URL` 變數中，取代 `'PASTE_YOUR_BACKUP_URL_HERE'`。
    ```javascript
    // --- PASTE YOUR BACKUP SHEET URL HERE ---
    const BACKUP_SHEET_URL = 'https://docs.google.com/spreadsheets/d/your_sheet_id/edit';
    // -----------------------------------------
    ```
4.  儲存檔案。
5.  執行 `RUN_THIS_TO_RESTORE_DATA` 函數。
6.  系統會自動讀取備份檔案，並將平台中不存在的記錄添加回去，**它不會添加重複的數據**，確保資料乾淨。
7.  在「執行記錄」中查看還原結果。

## 檔案結構

*   `Code.gs`: 包含所有後端邏輯，包括權限控制、數據處理、以及與 Google Form/Sheet 的互動。
*   `index.html`: 前端儀表板的 HTML、CSS 和 JavaScript 程式碼。
*   `log.html`: 顯示操作日誌的前端頁面。
*   `denied.html`: 當用戶沒有權限時顯示的頁面。

## 版權

Copyright © 2025 Wong Tsz Him, Hugo. All rights reserved.